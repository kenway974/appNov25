{% extends 'base.html.twig' %}
{% block title %}Souscrire{% endblock %}

{% block body %}
<div class="container mt-6 text-center">
    <h1>Confirmer l'abonnement</h1>

    <button id="checkout-button" class="btn btn-primary mt-4">Payer et s'abonner</button>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripePublicKey = '{{ stripe_public_key }}';
    const planId = {{ plan.id }};
    const button = document.getElementById('checkout-button');

    button.addEventListener('click', async () => {
        // appelle l'API backend pour cr√©er la session
        const resp = await fetch('{{ path('app_create_checkout_session', {'planId': plan.id}) }}', {
            method: 'POST',
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        });
        const data = await resp.json();
        if (data.error) {
            alert(data.error);
            return;
        }

        const stripe = Stripe(stripePublicKey);
        const result = await stripe.redirectToCheckout({ sessionId: data.id });
        if (result.error) {
            alert(result.error.message);
        }
    });
</script>
{% endblock %}
